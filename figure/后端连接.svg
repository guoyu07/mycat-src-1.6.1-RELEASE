<DIV class="flow-chart"><svg xmlns="http://www.w3.org/2000/svg" style="overflow: hidden; position: relative; top: -0.0625px;" width="1095.33" height="924.75" version="1.1"><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Created with Raphaël 2.1.0</desc><defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><path id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-linecap="round" d="M 5 0 L 0 2.5 L 5 5 Z" /><marker id="raphael-marker-endblock33" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" refX="1.5" refY="1.5" markerWidth="3" markerHeight="3" orient="auto"><use style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" fill="black" stroke="none" stroke-width="1.6667" transform="rotate(180 1.5 1.5) scale(0.6)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#raphael-marker-block" /></marker></defs><rect class="flowchart" id="st" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" fill="#ffffff" stroke="#000000" stroke-width="2" transform="matrix(1 0 0 1 115.469 63.25)" x="0" y="0" width="362.281" height="39" rx="20" ry="20" r="20" /><text class="flowchartt" id="stt" font-family="sans-serif" font-size="14px" font-weight="normal" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 14px; line-height: normal; font-family: sans-serif;" fill="#000000" stroke="none" text-anchor="start" transform="matrix(1 0 0 1 115.469 63.25)" x="10" y="19.5" font="10px &quot;Arial&quot;"><tspan style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" dy="5.5">MyCat接受客户端连接并为之建立唯一绑定的Session</tspan></text><rect class="flowchart" id="op1" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" fill="#ffffff" stroke="#000000" stroke-width="2" transform="matrix(1 0 0 1 169.492 215.5)" x="0" y="0" width="254.234" height="39" rx="0" ry="0" r="0" /><text class="flowchartt" id="op1t" font-family="sans-serif" font-size="14px" font-weight="normal" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 14px; line-height: normal; font-family: sans-serif;" fill="#000000" stroke="none" text-anchor="start" transform="matrix(1 0 0 1 169.492 215.5)" x="10" y="19.5" font="10px &quot;Arial&quot;"><tspan style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" dy="5.5">MyCat接受客户端的请求，计算路由</tspan></text><rect class="flowchart" id="op2" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" fill="#ffffff" stroke="#000000" stroke-width="2" transform="matrix(1 0 0 1 80.7891 367.75)" x="0" y="0" width="431.641" height="39" rx="0" ry="0" r="0" /><text class="flowchartt" id="op2t" font-family="sans-serif" font-size="14px" font-weight="normal" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 14px; line-height: normal; font-family: sans-serif;" fill="#000000" stroke="none" text-anchor="start" transform="matrix(1 0 0 1 80.7891 367.75)" x="10" y="19.5" font="10px &quot;Arial&quot;"><tspan style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" dy="5.5">根据请求和路由创建合适的handler，这里为SingleNodeHandler</tspan></text><rect class="flowchart" id="op3" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" fill="#ffffff" stroke="#000000" stroke-width="2" transform="matrix(1 0 0 1 174.719 520)" x="0" y="0" width="243.781" height="39" rx="0" ry="0" r="0" /><text class="flowchartt" id="op3t" font-family="sans-serif" font-size="14px" font-weight="normal" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 14px; line-height: normal; font-family: sans-serif;" fill="#000000" stroke="none" text-anchor="start" transform="matrix(1 0 0 1 174.719 520)" x="10" y="19.5" font="10px &quot;Arial&quot;"><tspan style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" dy="5.5">从PhysicalDBNode中获取后端连接</tspan></text><path class="flowchart" id="cond" font-family="sans-serif" font-weight="normal" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: sans-serif; font-weight: normal;" fill="#ffffff" stroke="#000000" stroke-width="2" transform="matrix(1 0 0 1 139.109 613)" d="M 78.75 39.375 L 0 78.75 L 157.5 157.5 L 315 78.75 L 157.5 0 L 0 78.75" /><text class="flowchartt" id="condt" font-family="sans-serif" font-size="14px" font-weight="normal" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 14px; line-height: normal; font-family: sans-serif;" fill="#000000" stroke="none" text-anchor="start" transform="matrix(1 0 0 1 139.109 613)" x="83.75" y="78.75" font="10px &quot;Arial&quot;"><tspan style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" dy="5.5">尝试获取连接，连接够用？</tspan></text><rect class="flowchart" id="e" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" fill="#ffffff" stroke="#000000" stroke-width="2" transform="matrix(1 0 0 1 142.234 883.75)" x="0" y="0" width="308.75" height="39" rx="20" ry="20" r="20" /><text class="flowchartt" id="et" font-family="sans-serif" font-size="14px" font-weight="normal" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 14px; line-height: normal; font-family: sans-serif;" fill="#000000" stroke="none" text-anchor="start" transform="matrix(1 0 0 1 142.234 883.75)" x="10" y="19.5" font="10px &quot;Arial&quot;"><tspan style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" dy="5.5">将请求发送给对应连接,处理完之后归还连接</tspan></text><rect class="flowchart" id="op4" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" fill="#ffffff" stroke="#000000" stroke-width="2" transform="matrix(1 0 0 1 715.719 672.25)" x="0" y="0" width="170" height="39" rx="0" ry="0" r="0" /><text class="flowchartt" id="op4t" font-family="sans-serif" font-size="14px" font-weight="normal" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 14px; line-height: normal; font-family: sans-serif;" fill="#000000" stroke="none" text-anchor="start" transform="matrix(1 0 0 1 715.719 672.25)" x="10" y="19.5" font="10px &quot;Arial&quot;"><tspan style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" dy="5.5">尝试异步创建新的连接</tspan></text><rect class="flowchart" id="op5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" fill="#ffffff" stroke="#000000" stroke-width="2" transform="matrix(1 0 0 1 508.109 824.5)" x="0" y="0" width="585.219" height="39" rx="0" ry="0" r="0" /><text class="flowchartt" id="op5t" font-family="sans-serif" font-size="14px" font-weight="normal" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 14px; line-height: normal; font-family: sans-serif;" fill="#000000" stroke="none" text-anchor="start" transform="matrix(1 0 0 1 508.109 824.5)" x="10" y="19.5" font="10px &quot;Arial&quot;"><tspan style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" dy="5.5">通过DelegateResponseHandler将连接与之前的Handler，这里是SingleNodeHandler绑定</tspan></text><path font-family="sans-serif" font-weight="normal" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: sans-serif; font-weight: normal;" fill="none" marker-end="url(&quot;#raphael-marker-endblock33&quot;)" stroke="#000000" stroke-width="2" d="M 296.609 102.25 C 296.609 102.25 296.609 194.561 296.609 212.5" /><path font-family="sans-serif" font-weight="normal" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: sans-serif; font-weight: normal;" fill="none" marker-end="url(&quot;#raphael-marker-endblock33&quot;)" stroke="#000000" stroke-width="2" d="M 296.609 254.5 C 296.609 254.5 296.609 346.811 296.609 364.75" /><path font-family="sans-serif" font-weight="normal" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: sans-serif; font-weight: normal;" fill="none" marker-end="url(&quot;#raphael-marker-endblock33&quot;)" stroke="#000000" stroke-width="2" d="M 296.609 406.75 C 296.609 406.75 296.609 499.061 296.609 517" /><path font-family="sans-serif" font-weight="normal" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: sans-serif; font-weight: normal;" fill="none" marker-end="url(&quot;#raphael-marker-endblock33&quot;)" stroke="#000000" stroke-width="2" d="M 296.609 559 C 296.609 559 296.609 598.654 296.609 610" /><path font-family="sans-serif" font-weight="normal" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: sans-serif; font-weight: normal;" fill="none" marker-end="url(&quot;#raphael-marker-endblock33&quot;)" stroke="#000000" stroke-width="2" d="M 296.609 770.5 C 296.609 770.5 296.609 862.811 296.609 880.75" /><text font-family="sans-serif" font-size="14px" font-weight="normal" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 14px; line-height: normal; font-family: sans-serif;" fill="#000000" stroke="none" text-anchor="start" x="301.6094" y="780.5" font="10px &quot;Arial&quot;"><tspan style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" dy="5.5">yes</tspan></text><path font-family="sans-serif" font-weight="normal" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: sans-serif; font-weight: normal;" fill="none" marker-end="url(&quot;#raphael-marker-endblock33&quot;)" stroke="#000000" stroke-width="2" d="M 454.109 691.75 C 454.109 691.75 683.68 691.75 712.713 691.75" /><text font-family="sans-serif" font-size="14px" font-weight="normal" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 14px; line-height: normal; font-family: sans-serif;" fill="#000000" stroke="none" text-anchor="start" x="459.1094" y="681.75" font="10px &quot;Arial&quot;"><tspan style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" dy="5.5">no</tspan></text><path font-family="sans-serif" font-weight="normal" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: sans-serif; font-weight: normal;" fill="none" marker-end="url(&quot;#raphael-marker-endblock33&quot;)" stroke="#000000" stroke-width="2" d="M 800.719 711.25 C 800.719 711.25 800.719 803.561 800.719 821.5" /><path font-family="sans-serif" font-weight="normal" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); font-family: sans-serif; font-weight: normal;" fill="none" marker-end="url(&quot;#raphael-marker-endblock33&quot;)" stroke="#000000" stroke-width="2" d="M 800.719 863.5 C 800.719 863.5 800.719 858.75 800.719 858.75 C 800.719 858.75 296.609 858.75 296.609 858.75 C 296.609 858.75 296.609 874.123 296.609 880.759" /></svg></DIV>